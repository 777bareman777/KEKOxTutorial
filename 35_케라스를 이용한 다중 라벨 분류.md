## 케라스를 이용한 다중 라벨 분류(Multi-label classification with Keras)
[원문 링크](https://www.pyimagesearch.com/2018/05/07/multi-label-classification-with-keras/)
> 본 튜토리얼에서는 하나의 CNN을 사용해 옷의 종류와 색을 모두 분류하는 다중 라벨 분석을 다룹니다.

* Keras
* CNN
* Multi-label 
* Classification

----

해당 튜토리얼은 총 네 부분으로 나뉩니다. 

첫 번째 파트에서는 다중 라벨 분류를 위한 데이터 셋(그리고 빠르게 자신만의 데이터 셋을 구축하는 법)에 대해 알아봅니다. 

두 번째 파트에서는 다중 라벨 분류를 위해 사용할 케라스 신경망 아키텍처인 `소형VGGNet`에 대해 알아본 후, 
해당 신경망을 구현해 봅니다.  

세 번째 파트에서는 직접 구현한 `소형VGGNet`을 다중 라벨 데이터 셋에 대해 학습시켜 봅니다. 

마지막으로 학습된 신경망을 예시 이미지들에 대해 테스트 해보는 것으로 본 튜토리얼을 마무리하고, 
다중 라벨 분석이 필요한 경우, 그리고 이 때 주의해야 할 점 몇가지를 알아보도록 하겠습니다. 

### 다중 라벨 분류를 위한 데이터 셋

![dataset image](https://www.pyimagesearch.com/wp-content/uploads/2018/04/keras_multi_label_dataset.jpg)  

데이터 셋은 다음을 포함하여 총 6개 범주에 걸쳐 2,167개의 이미지들로 구성됩니다. 
* 검정색 청바지 (344개의 이미지)
* 파란색 드레스 (386개의 이미지)
* 파란색 청바지 (356개의 이미지)
* 파란색 셔츠 (369개의 이미지)
* 빨간색 드레스 (380개의 이미지)
* 빨간색 셔츠 (332개의 이미지)

***다중 라벨 분류의 목표는 옷의 종류와 색을 모두 예측하는 모델을 만드는 것입니다***

본 튜토리얼에서 사용하는 데이터 셋은 [*해당 튜토리얼*](https://www.pyimagesearch.com/2018/04/09/how-to-quickly-build-a-deep-learning-image-dataset/)을 참고하여 만들었으며, 이미지들을 다운로드하고 6개의 클래스 각각에 대해 관련 없는 이미지들을 수동으로 제거하는 과정에는 약 30분의 시간이 걸립니다.

자체적으로 딥러닝을 위한 이미지 데이터 셋을 구축하려고 한다면 위에 링크된 튜토리얼은 아주 좋은 시작점이 될 것입니다. 

### 다중 라벨 분류 프로젝트 구조 
[***해당 링크***](https://www.getdrip.com/forms/550399608/submissions)에서 코드와 파일들을 다운로드 할 수 있습니다. 
zip 파일을 추출하면 다음과 같은 디렉토리 구조가 표시됩니다.

    ├── classify.py
    ├── dataset
    │   ├── black_jeans [344 entries]
    │   ├── blue_dress [386 entries]
    │   ├── blue_jeans [356 entries]
    │   ├── blue_shirt [369 entries]
    │   ├── red_dress [380 entries]
    │   └── red_shirt [332 entries]
    ├── examples
    │   ├── example_01.jpg
    │   ├── example_02.jpg
    │   ├── example_03.jpg
    │   ├── example_04.jpg
    │   ├── example_05.jpg
    │   ├── example_06.jpg
    │   └── example_07.jpg
    ├── fashion.model
    ├── mlb.pickle
    ├── plot.png
    ├── pyimagesearch
    │   ├── __init__.py
    │   └── smallervggnet.py
    ├── search_bing_api.py
    └── train.py

zip 루트에는 6개의 파일들과 3개의 디렉토리들이 표시됩니다. 이 문서에서 다루는 중요한 파일들은 다음과 같습니다.

1. `search_bing_api.py` : 이 스크립트를 사용하여 딥러닝 학습 이미지 데이터 셋을 빠르게 구축할 수 있습니다. 하지만 이미지 데이터 셋이 이미 zip 아카이브에 포함되어 있으므로 이 스크립트를 실행할 필요는 없습니다. 해당 코드는 프로젝트의 완결성을 위해서 추가되었습니다. 
2. `train.py` : 데이터가 모이면, 해당 스크립트를 사용하여 모델을 학습시킵니다. 
3. `fashion.model` : `train.py`에 의해 디스크에 저장된 모델 객체입니다. 후에 `classify.py`스크립트에서 사용하게 됩니다. 
4. `mlb.pickle` : `train.py`에서 생성된 파일로 `scikit-learn`의 `MultiLabelBinarizer` 객체입니다. 해당 파일은 데이터의 범주 이름들을 저장하고 있습니다. 
5. `plot.png` : `plot.png`는 학습의 결과로 `train.py`에서 생성됩니다. 자체적으로 구축한 데이터 셋에 대해 학습을 진행하는 경우, 해당 파일을 통해 과적합 여부를 확인해 보는게 좋습니다. 
6. `classify.py` : 분류기를 테스트하기 위한 스크립트입니다. 항상 다른 곳에(아이폰 딥러닝 앱이나 라즈베리 파이 딥러닝 프로젝트 같은) 모델을 배포하기 전에는 로컬에서 테스트를 거쳐야 합니다. 

프로젝트의 세 가지 디렉토리들은 다음과 같습니다.

1. `dataset` : 이 디렉토리는 이미지 데이터 셋을 저장하고 있으며, 각 범주마다 고유의 하위 디렉토리가 있습니다. 이 작업을 통해 (1) 데이터 셋의 구조를 정돈할 수 있으며 (2) 주어진 이미지 경로가 속한 범주의 이름을 쉽게 추출할 수 있습니다.   
2. `pyimagesearch` : `pyimagesearch`는 케라스 신경망을 포함하는 모듈입니다. `__init__.py` 파일은 해당 디렉토리를 모듈로 관리하기 위하여 존재합니다. 또 다른 파일인 `smallervggnet.py`는 신경망 모델을 만들기 위한 코드를 포함하고 있습니다.  
3. `examples` : 이 디렉토리에는 7개의 예제 이미지들이 있습니다. 각각의 이미지에 대해 `classify.py`를 사용하여 다중 라벨 분류를 진행하게 될 것입니다. 

### 다중 라벨 분석을 위한 케라스 신경망 아키텍처

![model architecture](https://www.pyimagesearch.com/wp-content/uploads/2018/04/cnn_keras_smallervggnet.png)

본 튜토리얼에서 사용하고 있는 CNN 아키텍처인 `소형VGGNet`은 `VGGNet`의 단순화된 버전입니다. `VGGNet`모델은 2014년 Simonyan과 Zisserman의 논문 [***Very Deep Convolutional Networks for Large Scale Image Recognition***](https://arxiv.org/pdf/1409.1556/)에서 처음 소개되었습니다. 

`소형VGGNet`의 아키텍처/코드에 대한 자세한 설명은 [***이 포스트***](https://www.pyimagesearch.com/2018/04/16/keras-and-convolutional-neural-networks-cnns/)에서 다루고 있습니다. 만약 자체적으로 모델을 디자인하고 싶다면 [***Deep Learning for Computer Vision with Python***](https://www.pyimagesearch.com/deep-learning-computer-vision-python-book/) 책을 참조해 보는 것도 좋습니다.

앞서 코드와 파일들을 다운로드 받았다면, `pyimagesearch`모듈의 `smallervggnet.py`파일을 살펴보도록 하겠습니다. 
